## 10. 연예인 캐스팅(?) (C 언어에서의 형 변환)

아니 형변환이라고 제목 붙이고 대부분의 내용은 소수점 저장 방식을 설명했다. 강의자분.. 제목 만드는데 소질이 없어보인다. 이런 내용이라면 2-3이나 4-2처럼 수표현 방법의 제목을 작성하면 좋아보인다..

배우는 내용

- 형 변환(캐스팅)이 무엇인지 안다.
- 부동 소수점에 대해 자세히 알아본다.

### 컴퓨터가 실수를 표현하는 원리

`float`나 `double` 같은 소수점을 저장하는 자료형은 어떻게 수를 저장하는지 확인하기 전에 컴퓨터가 어떻게 소수를 저장하는지 살펴보자.

- 컴퓨터 상에서 실수를 표현하는 방법은 대표적으로 고정 소수점(Fixed Point) 방식과 부동 소수점(Floating Point) 방식이 있다.
  - 현대 컴퓨터는 부동 소수점 방식을 채택한다.
  - 부동 소수점은 고정 소수점 방식보다 같은 비트에서 표현할 수 있는 수가 더 넓다.
  - 부동 소수점은 고정 소수점 방식보다 수의 정밀도가 떨어진다.
- 부동 소수점 방식을 통해 수를 표현하는 방법은 국제전기전자기술자협회(IEEE) 에서 1985년에 IEEE-754 라는 이름으로 표준화 하였다.
- 컴퓨터는 `±f×b^e`과 같은 과학적 표기(scientific notation)로 수를 표현한다.
  - `f` 는 가수, `b` 는 밑, `e` 는 지수
  - 컴퓨터는 기본적으로 이진수를 사용하므로 b는 2이다.
  - 컴퓨터는 소수 데이터를 보관할 때 `f`, `e`와 부호 비트(1 비트) 를 저장한다.
  - `float`는 가수(`f`) 부분이 23 비트를 차지하고, 지수(`e`) 부분이 8 비트, 그리고 부호 비트가 1 비트를 차지하여 총 4 바이트를 사용한다.
  - `double`는 가수(`f`) 부분이 52 비트를 차지하고, 지수(`e`) 부분이 11 비트, 그리고 부호 비트가 1 비트를 차지하여 총 8 바이트를 사용한다.
  - 참고로 `double`의 이름 유래는 `float` 크기의 2배이기 때문..

아래 그림은 IEEE 754 에서 정의한 부동 소수점 표현이다.

![](https://modoocode.com/img/1142E8024B67FFE861B8C8.webp)

위의 크기 내에서 10진수 소수를 2진수로 저장하면 된다.

어떻게 10진수 소수점을 컴퓨터가 사용하는 2진수로 저장할까?

일반적인 변환법과 똑같이 진행하면 된다. 예를들어 10진수로 0.5는 2진수로 0.1(2^-1) 10진수로 12.625는 2진수로 110.101(2^3+2^2+2^-1+2^-3)이 된다.

- 2진법으로 표시된 모든 소수들은 모두 10진법으로 변환이 가능하다.
  - 10진법으로 표시된 모든 소수는 이진법으로 바뀌지 않는다.
  - 대표적으로 0.1은 2진법으로 무한소수이다.
- 무한 소수들을 모두 메모리에 나타낼 수 없기 때문에 일정 부분만 잘라 메모리에 보관한다.
  - 이 때문에 컴퓨터에서 소수점이 있는 수를 저장하면 오차가 발생하게 된다.

IEEE 754 방식으로 소수 저장하는 방법은 위에서 설명한 것 처럼 10진수를 2진수 소수로 바꾸고 Bias(2^(e−1)−1)를 더한다. `float` 이면 8 이므로 127, `double` 형이면 11이므로 1023 을 더한다. 이유는 수를 항상 양수로 보기 위해 더하는 것이다.

2의 보수 뺄셈도 A-B가 아니라 A+(-B)로 바꾸어 생각하는 것과 같다.

수의 표현은 크기에 제한적이기 때문에 IEEE 754 에서는 정상적이지 않는 수를 표현하기 위해서 아래과 같이 규칙을 정했다.

![image](https://github.com/ii200400/IT_Skill_Question/assets/19484971/4da651f2-42a2-40e9-8919-bbf27e3e8d48)

각각의 의미는 다음과 같다.

비정상 수 (Denormalized number) : 너무 작아서 자료형으로는 표기할 수 없는 수

무한대 : 연산 과정에서 표현할 수 있는 가장 큰 수 보다 더 큰 값이 들어간다면 자동으로 발생한다. 아래의 코드로 확인할 수 있다.

```
#include <stdio.h>

int main() {
  float a = 1. / 0.f;
  printf("a : %f \n", a);
  return 0;
}
```

수가 아님 (NaN, Not-a-Number) : 값을 정할 수 없는 연산 중에 발생한다. 예를들어 ∞−∞, −∞+∞,0×∞, 0÷0, ∞÷∞ 등이 있다.

위의 규칙으로 `float` 의 경우 지수에 들어가는 값의 범위가 1 부터 254 까지이다. 0은 비정상수로 들어가고 255는 무한대로 치부된다.

### 타입 캐스팅

C언어에서 서로 다른 자료형끼리의 연산이나 대입은 문제가 생긴다. 때문에 타입 캐스팅을 할 필요가 있다.

```
/* 10 1 형변환 */

#include <stdio.h>

int main() {
	int a;
	double b;

	b = 2.4;
	a = (int)b;

	printf("%d", a);

	return 0;
}
```

경고가 없이 결과가 출력되는 것을 볼 수 있다.

![image](https://github.com/ii200400/IT_Skill_Question/assets/19484971/f27a4701-88c6-4b3d-abe5-25acd2b5d3dd)

이유는 바로 우리가 강제로 형변환(캐스팅) 을 하였기 때문이다. 타입 캐스팅을 사용하면 컴파일러는 코더가 의도적으로 타입을 변환한다고 생각하여 메시지를 출력하지 않는다.

```
/* 10 2 두 수의 비율 */

#include <stdio.h>

int main() {
	int a, b;
	float c, d;

	printf("두 숫자 입력 : ");
	scanf("%d %d", &a, &b);

	c = a / b;
	d = (float)a / b;

	printf("두 수의 비율 : %f %f", c, d);

	return 0;
}
```

![image](https://github.com/ii200400/IT_Skill_Question/assets/19484971/e9130524-2fda-46c3-83e1-c31dd59ddd11)

타입 캐스팅을 사용한 부분은 소수점 아래자리까지 나왔고 그렇지 않은 계산은 몫만이 계산되어 1이 나오는 것을 볼 수 있다. 이렇게 출력이 다를 수 있으므로 형 변환은 꼭 잘 고려해서 넣어주어야 한다.

### 후기

예전에 C언어를 사용할 때 타입 캐스팅을 안하면 무조건 오류가 생겨서 컴파일도 안되었던 것 같은데.. 기억이 가물가물하다. 확실한 것은 지금 비주얼 스튜디오에서는 경고로 그치고 알아서 데이터가 잘려 들어간다.편하다.

마찬가지로 11강도 개인적으로 필요한 부분만 정리할 예정이다.

- [11 - 1. C 언어의 아파트 (배열), 상수](./11-1.md)
