# 2D 변환 (2D Transformation)

`목차`

* [개요](#개요)
* [Rigid Transformation (강체 변환)](#rigid-transformation-강체-변환)
  + [평행이동(translation)만을 허용한 경우](#평행이동translation만을-허용한-경우)
  + [회전(rotation)만을 허용한 경우](#회전rotation만을-허용한-경우)
  + [Rigid 변환](#rigid-변환)

## 개요

이름 그대로 주어진 2D 물체의 위치, 크기, 방향, 모양 등을 바꾸는 것을 의미한다.

다른 곳에서도 다양하게 활용되겠지만, 카메라 켈리브레이션에서는 이를 활용하여 물체를 탐지하고 추적하여 두 이미지의 물체가 같은 물체인지 매칭할 때 쓰인다.

<img src="https://user-images.githubusercontent.com/19484971/196948841-77b109f8-c1ee-4134-a767-63b28ceb9b99.png" width=500>

- 두 물체를 매칭할 때 관계를 모델링한다고 한다.
  - 어떤 변환 모델을 사용할지는 문제에 따라 적절하게 적용하는 것이 좋다.
  - 회전변화를 고려할지, 스케일 변화를 고려할지, 아니면 affine 또는 원근(perspective) 변화까지도 고려할지를 잘 선택하자.
  - 원근(perspective) 변환은 자주 쓰이지만 자유도가 높아 원하지 않은 결과를 낼 확률도 높다고 한다.
  - 모델링이라는 단어는 보통 3D에서 쓰는 단어인데.., 그런 의미의 모델링이 아니라 수식을 만든다는 의미같다.
- 용어 정의
  - 이미지 I에서의 점들은 X = (xi, yi)
  - 이미지 I'에서 X에 대응되는 점들은 X' = (xi', yi')
  - X와 X' 사이의 변환 관계 중 회전변화(rotation)를 R, 평행이동(translation)을 T

- 참고 블로그
  - [[영상 Geometry #3] 2D 변환 (Transformations)](https://darkpgmr.tistory.com/79)
  - [늦깎이 공대생의 좌충우돌 이야기:티스토리](https://elecs.tistory.com/151)

## Rigid Transformation (강체 변환)

우선 강체는 위키백과에서 아래와 같이 정의한다.

> 강체(剛體, Rigid body)란 물리학에서 형태가 고정되어 변하지 않는 물체를 가리킨다. 강체는 외력이 가해져도 모양이나 크기가 변형되지 않는다.
-위키백과-

단순히 말하면.. 그냥 물체이다. 즉, 물체의 형태와 크기를 유지한체 위치와 방향(rotation)만 바뀔 수 있는 변환을 의미한다.

위에서 관계를 모델링할 때 어떤 모델을 사용할지에 관해 작성을 했는데, 먼저 제약이 심한 경우부터 천천히 살펴보겠다.

### 평행이동(translation)만을 허용한 경우

추적 대상의 크기가 고정이고 회전도 일어나지 않는 경우에는 위치 변화만을 추적할 것이다. 

이때의 점 (xi, yi)에 대응하는 점 (xi', yi')은 (tx, ty)만큼 움직여서 매칭된다고 하면 아래와 같은 수식을 사용할 수 있다.

<img src="https://user-images.githubusercontent.com/19484971/196970596-6ffb7c6a-4649-4959-8612-3bb4ccac3f78.png" width=200>

### 회전(rotation)만을 허용한 경우

이번에는 회전만 일어나는 경우를 살펴보겠다. 회전행렬을 통해서 대응하는 점을 찾아볼 수 있는데 수식으로 만들면 아래와 같다. (물론 회전의 기준은 원점)

참고로 회전변환에서는 자유도(degree of freedom)라는 말이 자주 언급되는데 이것은 이미지가 변환이 될 때 최소한으로 필요로 하는 독립변수의 수.. 라고 한다;

필자는 한 점이 거리가 같은 다른 점으로 이동할 때 필요한 최소한의 변수라고 생각하고 있다. 2차원이면 회전변환의 자유도는 1, 3차원이면 자유도는 2와 같이 n차원에서의 자유도는 n-1인 것.. 같다!

<img src="https://user-images.githubusercontent.com/19484971/196971631-0396f567-ae6c-4458-9f2c-f08632341d64.png" width=200>

현실에서는 회전변환만을 사용해서 두 물체가 매칭되는지 확인하기 쉽지 않다. 때문에 보통은 스케일(scale) 변화(크기 변화)까지 고려하여 변환을 구한 후, 나중에 스케일 변화를 제거하는 방식을 사용한다고 한다.

스케일 변화까지를 고려한 회전변환은 일반적으로 다음과 같이 표현할 수 있다. (a = s*cosθ, b = s*sinθ)

<img src="https://user-images.githubusercontent.com/19484971/196989036-1aefdd6c-85d3-47eb-8121-7cfaa65df0ec.png" width=200>

a, b에 관해 묶으면 다음과 같은 형태로 바꿀 수 있다.

<img src="https://user-images.githubusercontent.com/19484971/196989139-25105c8b-b80a-4026-b01a-10e240706a24.png" width=200>

매칭 쌍을 하나만 대입해도 역행렬을 이용하여 a, b를 구할 수 있고 만약 매칭하는 쌍이 여러 개라면 최소자승법(Least Square method)이라는.. 실제 값과 추정값의 차이를 최소화하는 방법을 활용해서 구한다.

<img src="https://user-images.githubusercontent.com/19484971/196993651-fb2d1dff-0346-410b-8b3f-a463e6216bb2.png" width=200>

a, b를 구하고 나면 스케일(scale) s와 회전각 θ는 다음과 같이 계산할 수 있다.

<img src="https://user-images.githubusercontent.com/19484971/196995225-1b3fadc1-00b0-4e5e-bcad-d910d9da5c86.png" width=200>

이렇게하면 물체의 크기 변화와 회전변환을 통해 두 점 집합 사이의 매핑 관계를 설명할 수 있다! 

하지만, 보통은 이미지의 이미지 원점(이미지 왼쪽 상단 모서리)을 중심으로 한 회전변환이 아니라 카메라나 현재 물체의 위치를 기준으로 회전이 일어나는 경우가 대부분이기 때문에 조금 더 표준화한 rigid 변환 모델을 필요로 한다.

### Rigid 변환

